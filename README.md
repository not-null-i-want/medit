#  👨‍⚕️ Team 낫널원해 : MEDIT
<div align="center">
  
![ppt_front](https://github.com/not-null-i-want/medit/assets/145624456/0919f029-f375-4106-a0a4-d4bcd180c3b9)
</div>

## 📑 프로젝트 소개
### `주제 : ResNet50 모델을 활용한 TTA-CXR 분석 기반 폐 질환 진단 서비스`
- 스마트인재개발원 인공지능 융합서비스 과정의 마지막 프로젝트로써 기업의 멘토링을 받아 개발하였습니다.
- 의료인들에게 즉각적으로 드러나지 않을 수 있는 패턴을 식별 가능하게 하여 질환을 조기에 발견함으로써 적시에 개입할 수 있고 **오진을 막는데에 도움**을 주고자 합니다.
- 일관되고 객관적인 분석을 제공하여 **효과적인 치료 계획을 설립**할 수 있도록 합니다.
- 의료인이 부족하다면 보조 진단 도구 역할을 하여 **의사 결정에 도움**을 줄 수 있도록 합니다.
<br>

## 📅 프로젝트 기간
- **계획 / 분석 / 설계** : 　２４. ０１. １７ ~ ２４. ０２. １２
- 　　　**구현**　　 　: 　２４. ０２. １３ ~ ２４. ０３. ０６
<br>

## 🔨 사용 기술

<table>
    <tr>
        <th>구분</th>
        <th>내용</th>
    </tr>
    <tr>
        <td>Back-end</td>
        <td>
            <img src="https://img.shields.io/badge/Java-007396?style=for-the-badge&logo=java&logoColor=white"/>
	    <img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
            <img src="https://img.shields.io/badge/Spring%20Boot-6DB33F?style=for-the-badge&logo=Spring%20Boot&logoColor=white">
            <img src="https://img.shields.io/badge/Apache%20Maven-C71A36?style=for-the-badge&logo=Apache%20Maven&logoColor=white"/>
            <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
            <img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=Python&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>Front-end</td>
        <td>
            <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white">
            <img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white">
            <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
            <img src="https://img.shields.io/badge/Thymeleaf-%23005C0F?style=for-the-badge&logo=Thymeleaf&logoColor=black">
        </td>
    </tr>
    <tr>
        <td>Database</td>
        <td>
            <img src="https://img.shields.io/badge/oracle-F80000?style=for-the-badge&logo=oracle&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>Server</td>
        <td>
            <img src="https://img.shields.io/badge/apache tomcat-F8DC75?style=for-the-badge&logo=apachetomcat&logoColor=white">
            <img src="https://img.shields.io/badge/flask-%23000?style=for-the-badge&logo=flask&logoColor=white">
        </td>
    </tr>
   <tr>
        <td>Distribution</td>
        <td>
            <img src="https://img.shields.io/badge/AWS ec2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white">
            <img src="https://img.shields.io/badge/AWS s3-569A31?style=for-the-badge&logo=amazons3&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>Library & API</td>
        <td>
            <img src="https://img.shields.io/badge/jquery-0769AD?style=for-the-badge&logo=jquery&logoColor=white">
	    <img src="https://img.shields.io/badge/Spring Data JPA-bcae79?style=for-the-badge&logo=&logoColor=white"/>
            <img src="https://img.shields.io/badge/Canvas-007CE2?style=for-the-badge&logo=Canvs&logoColor=white">
            <img src="https://img.shields.io/badge/chart.js-F5788D?style=for-the-badge&logo=chart.js&logoColor=white">
            <img src="https://img.shields.io/badge/kakaoMap API-FFCD00?style=for-the-badge&logo=kakao&logoColor=white">
			<img src="https://img.shields.io/badge/pytorch-EE4C2C?style=for-the-badge&logo=pytorch&logoColor=white">
			<img src="https://img.shields.io/badge/opencv-5C3EE8?style=for-the-badge&logo=opencv&logoColor=white">
        </td>
    </tr>
    <tr>
        <td>IDT</td>
        <td>
            <img src="https://img.shields.io/badge/eclipse-2C2255?style=for-the-badge&logo=eclipseide&logoColor=white">
            <img src="https://img.shields.io/badge/Visual%20Studio%20Code-0078d7?style=for-the-badge&logo=visual-studio-code&logoColor=white"/>
            <img src="https://img.shields.io/badge/SQL Developer-777777?style=for-the-badge&logo=&logoColor=white"/>
            <img src="https://img.shields.io/badge/AWS-%23FF9900?style=for-the-badge&logo=amazon-aws&logoColor=white"/>
        </td>
    </tr>
    <tr>
        <td>Etc.</td>
        <td>
            <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
            <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
        </td>
    </tr>
    
</table>
<br>

## 🗃 시스템 아키텍처
<div align="center">

![medit architecture](https://github.com/not-null-i-want/medit/assets/145624456/67a20768-3b6c-43d4-a896-cb0d7678e5de)
 </div>

## 🎫 ERD
![medit DB](https://github.com/not-null-i-want/medit/assets/145624456/27d0f475-2145-46f1-b0d6-8dd9d013117f)
<br>

## 🔌 구성 및 흐름도
![medit flow](https://github.com/not-null-i-want/medit/assets/145624456/332e44a8-a306-4784-806f-f9eeb1879ad7)
<br>

## ✒ 구현 전 화면설계
<br>
<details>
<summary><b>화면설계 펼치기</b></summary>
<div markdown="1">
	
![Login](https://github.com/not-null-i-want/medit/assets/145624456/7303b72c-11eb-4f8d-b59c-b6cf4819d8f9)
![Main](https://github.com/not-null-i-want/medit/assets/145624456/546b4c29-6611-4703-8677-907b247a7b92)
![PatientRegistration](https://github.com/not-null-i-want/medit/assets/145624456/a0d7c99d-4f93-4374-bdf5-3af5939a9c73)
![Diag](https://github.com/not-null-i-want/medit/assets/145624456/ad87a368-89be-4b43-bd15-9910ab414bde)
![Select](https://github.com/not-null-i-want/medit/assets/145624456/ee4ce8db-0c2e-47d6-81ee-572b7cb9bdc0)
![Select2](https://github.com/not-null-i-want/medit/assets/145624456/76bad73e-1dd2-4b4c-bfd3-a05508f651fc)
![Messanger](https://github.com/not-null-i-want/medit/assets/145624456/559060c2-aeda-4077-b5df-b600a4fe5a68)
</div>
</details>
<br>

## 📚 주요 기능
###### (문장을 클릭하면 자세히 볼 수 있습니다.)
<details>
<summary><b>로그인을 제외한 모든 기능 비동기화</b></summary>
<div markdown="1">
	
![image](https://github.com/not-null-i-want/medit/assets/145624456/b1f97539-909e-4066-97e0-5991a5c69bfd)
</div>
</details>

<details>
<summary><b>환자를 관리할 수 있는 기본적인 기능(환자 추가, 환자 검색 및 환자 목록, 환자 정보 상세보기, 소견서 작성 및 수정, 진단 등)</b></summary>
<div markdown="1">

- 환자 등록<br>
![MEDIT-Chrome2024-03-0610-43-58-ezgif com-video-to-gif-converter](https://github.com/not-null-i-want/medit/assets/145624456/0485d329-84f4-4595-a201-5a7f67e5c951)

- 환자 목록 및 검색, 상세 정보<br>
![MEDIT-Chrome2024-03-0611-35-02-ezgif com-video-to-gif-converter](https://github.com/not-null-i-want/medit/assets/145624456/06baca65-ec8a-467f-97f7-5b5daeec803d)

- 소견 작성 및 수정<br>
![소견작성](https://github.com/not-null-i-want/medit/assets/145624456/ef71e151-f39d-4a68-a9b0-6b9d43d2cdd4)

- 진단<br>
![진단](https://github.com/not-null-i-want/medit/assets/145624456/25ca7f15-0aae-4c0e-88b7-4ba0b5ec5e8f)
</div>
</details>

<details>
<summary><b>웹소켓을 이용하여 실시간 통신을 가능하게함으로써 의료진들의 일대일 채팅 지원</b></summary>
<div markdown="1">

![채팅](https://github.com/not-null-i-want/medit/assets/145624456/774a9d77-2997-4125-8a46-5881c6350b8e)
</div>
</details>

<details>
<summary><b>효율적인 데이터 로딩과 가독성을 위해 목록을 출력해주는 기능들의 페이징 처리(환자 목록, 진료 날짜 목록)</b></summary>
<div markdown="1">

![MEDIT-Chrome2024-03-0609-49-03-ezgif com-video-to-gif-converter (1)](https://github.com/not-null-i-want/medit/assets/145624456/4b238501-1d2b-4fac-a861-10cbdc64e1f8)
</div>
</details>

<details>
<summary><b>사용자가 확인할 수 있는 각 질환에 해당하는 CXR 제공(비교군)</b></summary>
<div markdown="1">

![비교군](https://github.com/not-null-i-want/medit/assets/145624456/e589100b-c56d-44d0-966b-40b9aaf28f53)
</div>
</details>

<details>
<summary><b>HTML5 Canvas를 이용한 CXR 편집(그리기, 펜 굵기 조절, 색 변경, ON/OFF 토글, 클리어)</b></summary>
<div markdown="1">

![canvas](https://github.com/not-null-i-want/medit/assets/145624456/41d22ba5-f142-4fcf-808d-278411d1c401)

![MEDIT-Chrome2024-03-0608-54-50-ezgif com-video-to-gif-converter](https://github.com/not-null-i-want/medit/assets/145624456/99c54144-4140-4131-9efd-bf6c4e5d1d52)
</div>
</details>

<details>
<summary><b>딥러닝으로 진단된 각 질환에 대한 확률값들을 Chart.js로 그래프화</b></summary>
<div markdown="1">

![그래프](https://github.com/not-null-i-want/medit/assets/145624456/94abb003-71a9-4f98-811a-41398ae9d4cb)
</div>
</details>

<details>
<summary><b>CXR 이미지 업로드 즉시 ResNet 모델을 이용하여 결과를 추론하고 확률 및 레이블 처리, CAM(Class Activation Map) 이미지 생성</b></summary>
<div markdown="1">

- **[[Model Repository]](https://github.com/not-null-i-want/chest-xrv-diagnosis)**

- **결과 추론 과정**
  
	---

	1. **모델 및 관련 설정**: 코드는 ResNet 모델을 사용하며, 이 모델은 torchXrayVision패키지에서 가져온 것입니다. 모델은 사전 학습된 가중치인 "resnet50-res512-all"로 초기화되며, GradCAM을 통해 어떤 레이어를 타겟으로 할 것인지 정의합니다.
   
	2. **이미지 다운로드 및 로드**: 사용자가 제공한 이미지 URL을 사용하여 이미지를 다운로드하고, OpenCV를 사용하여 이미지를 로드합니다. 이미지는 그레이스케일로 변환되어 처리됩니다.
   
	3. **이미지 전처리 및 테스트**: 이미지는 다양한 크기로 조정되며, 필요에 따라 히스토그램 평활화와 이미지 반전이 적용됩니다. 그 후, 이미지는 모델의 입력 형식에 맞게 정규화되고, 모델을 통해 테스트됩니다.

	4. **결과 처리**: 추론된 결과는 확률 및 레이블로 처리됩니다. 결과에 대한 적절한 처리가 수행된 후, 해당 결과를 반환하고 화면에 표시됩니다.
   
	5. **이미지 생성 및 업로드**: 결과가 정상이 아닌 경우, CAM (Class Activation Map) 이미지가 생성되고 S3에 업로드됩니다. CAM 이미지는 모델이 어떤 부분을 보고 각 결과를 도출했는지 시각적으로 보여줍니다.

	<br>

- **기존 torchXrayVision에 추가 작업**

  	---
  
  	1. **GradCAM 적용**: GradCAM(Gradient-weighted Class Activation Mapping)은 모델의 활성화를 시각화하고, 모델이 예측에 사용한 중요한 영역을 확인하는 데 사용됩니다. 코드에서는 GradCAM을 사용하여 모델이 예측한 결과에 대한 활성화 맵을 생성하고 시각화하는 과정이 추가되었습니다.<br>

	<div align="center">
		
  	![image](https://github.com/not-null-i-want/medit/assets/145624456/a0e72cf8-3030-449d-828f-897e7faef53e)
	</div>

	---

 	2. **TTA(Test-Time Augmentation) 적용**: TTA는 테스트 시에 데이터 증강을 적용하여 모델의 성능을 향상시키는 기법입니다. 코드에서는 TTA를 적용하여 이미지를 여러 크기로 조정하고, 히스토그램 평활화 및 이미지 뒤집기 등의 데이터 증강 기법을 적용하여 모델의 예측 정확도를 높이는 작업이 수행되었습니다.
     
     	- **히스토그램 평활화(Histogram Equalization)**: 이미지의 대비를 향상시키기 위해 히스토그램을 조정하는 기술입니다. 이를 통해 어두운 이미지의 세부 정보를 뚜렷하게 표현할 수 있습니다.
     
	    - **이미지 반전(Flip)**: 이미지를 좌우로 뒤집어 증강시키는 것으로, 데이터의 다양성을 높이고 모델이 다양한 각도에서 이미지를 이해할 수 있도록 돕습니다.
 
  	<div align="center">
		
  	![image](https://github.com/not-null-i-want/medit/assets/145624456/997a3374-6c3e-46bb-89a2-04b0a66f76c3)
	</div>

	---

 	3. **맵핑 및 결과 처리**: 모델이 출력하는 각 병변에 대한 확률을 분석하여 특정 임계값 이상인 경우에만 해당 병변으로 판정합니다. 또한, GradCAM을 통해 생성된 활성화 맵을 사용하여 특정 병변과 관련된 이미지 영역을 시각화하고, 이를 사용자에게 제공합니다.
     
		- 모델의 출력에서 각 병변에 대한 확률 분석, 특정 임계값 이상인 경우에만 해당 병변으로 판단합니다.
	   	<div align="center">
			
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/17092413-648e-4355-ba39-9bb22d9442c4)
		</div>

  		- GradCAM을 통해 생성된 활성화 맵을 사용하여 특정 병변과 관련된 이미지 영역을 시각화하여 사용에게 제공합니다.
		<div align="center">
			
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/6f23589f-67ab-481a-a382-8381fad58657)
		</div>

	---

  	4. **aws s3로의 이미지 업로드 및 URL 반환**: 처리된 이미지를 AWS S3에 업로드하고, 업로드된 이미지의 URL을 스프링부트로 전송합니다.

	---
  
  	5. **마스킹 작업**
  	   
  		１. 테스트된 확률값과 CAM(클래스 활성화 맵)을 기반으로 한 임계값을 설정합니다.
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/0a9e46ce-7af9-41ea-a6a1-6c82e3f73123)

  		２. 임계값보다 높은 확률을 가진 레이블에 대해서만 마스킹을 진행합니다.<br>
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/d5ad2058-a52f-41ac-bfb3-850f8b667967)


  		３. 마스킹을 위해 CAM을 정규화합니다.<br>
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/9124ffb1-8fe3-4034-9912-8f3aa8e621ee)


  		４. 가우시안 블러(Gaussian Blur)를 적용하여 CAM을 부드럽게 만듭니다.
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/f25552e8-8d83-42cd-80f2-de0b4023e496)


  		５. CAM에서 특정 임계값 이상의 윤곽선을 추출합니다.
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/7aacb65b-d295-4815-9c15-9edb2764913f)


  		６. 추출된 윤곽선을 기반으로 병변 영역을 표시하기 위해 히트맵을 생성합니다.
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/32bfd0f8-f1b8-4a71-8d44-604c94e40ffc)


  		７. 히트맵과 윤곽선을 원본 이미지에 겹쳐서 마스킹된 이미지를 생성합니다.
	  	![image](https://github.com/not-null-i-want/medit/assets/145624456/e7303c18-e6f5-440b-be65-4d9492cb15d7)

<br>
<br>
<br>

- **추가 작업 후 변경점**

---

  - 추가 전<br>
  ![image](https://github.com/not-null-i-want/medit/assets/145624456/aaea8950-f72c-4520-a9a4-3b29853059e3)


  - 추가 후<br>
  ![image](https://github.com/not-null-i-want/medit/assets/145624456/4506eb19-b883-4a6e-8b5e-3ac5433ae173)

</div>
</details>

<details>
<summary><b>13가지의 폐 질환에 대해 추론</b></summary>
<div markdown="1">

<br>
	
- **Atelectasis(무기폐)** : 폐는 정상적으로 풍선과 같이 공기를 품고 팽창되어 있어야 하는 장기인데, 어떠한 이유에 의해서 폐의 일부가 팽창된 상태를 유지하지 못하고, 부피가 줄어 쭈그러든 것을 말한다.
	
	![image](https://github.com/not-null-i-want/medit/assets/145624456/a9e873c0-24c9-45e2-a4d0-2a03bdd23089)
 
	![image](https://github.com/not-null-i-want/medit/assets/145624456/f46ee798-5b9e-4a73-9d81-7ebec7ad4d51)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/6a4d138a-c62f-4f05-9ae2-814eb1174253)

	![image](https://github.com/not-null-i-want/medit/assets/145624456/963bd118-8c74-431a-a7fa-a0cdadd2409b)

<hr>

- **Effusion(흉막삼출, 흉수)** : 삼출이란 염증이 생겼을 때 핏줄이나 미세한 구멍에서 조직이나 체강 속으로 스며 나오는 세포 성분과 액체 성분이다.
흉막 삼출은 폐의 흉막에서 체액 성분이 스며나오는 삼출 증상이 나타나는 질환을 말한다. 
원인 질환에 의하여 흉막에서 흡수되는 체액보다 생성되는 체액이 많아질 때 발생한다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/e5448497-6dd3-4f6e-bdca-b79b57655990)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/b9113296-7427-4ea6-b5f8-4be282f9e15a)

<hr>

- **Infiltration(침윤음영)** : 조직이나 세포에 정상이 아닌 물질이나 비정상적으로 과다한 물질이 축적, 침착하는 것. 또한 이와 같이 하여 축적된 물질을 가리키기도 한다. 즉, 이상세포 성분의 증가된 상태.
흉부 X-선사진에서는 주로 경계가 불투명한 음영을 표현하는 것을 말한다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/a8bddf75-6690-48e8-9ff1-7ab25e4638cc)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/0c0f7a75-e548-474a-8943-af4cf221ee61)

<hr>

- **Mass(폐 종괴)** : 혹의 특성을 정확히 모르면 '종괴'라고 부른다. 종괴는 피부 겉으로 튀어나와 있기도 하고, 피부 안에 숨어 겉으로 티가 나지 않기도 한다. 결절에 비해 큰 혹이다. 종괴와 결절을 구분하는 명확한 기준은 없다. 폐의 경우 3cm보다 작은 경우 결절, 3cm보다 크면 종괴라고 판단함.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/5fc762ed-fd1a-4c65-a712-05193ddab620)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/fd0b5aa5-d095-42ff-9aaf-59b2eedb2565)

<hr>

- **Nodule(폐 결절)** : 폐결절은 폐 내부에 생긴 지름 3cm 미만의 작은 구상 병변이다. 
한 개만 있는 것을 고립성 폐결절, 여러 개 있는 것을 다발성 폐결절단순이라고 한다 .
염증 흔적인 경우 많다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/e8e2dc2e-b261-46fc-85e0-b3c3fd7125a0)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/fa3d1580-ab3e-48a9-a59c-26db6c4d4d77)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/d6c01d8a-58cd-4220-9fbc-dbe7bfa2e841)

<hr>

- **Pneumonia(폐렴)** : 폐렴은 세균이나 바이러스, 곰팡이 등의 미생물로 인한 감염으로 발생하는 폐의 염증이다.
흉부 X-선상 특징적인 소견으로 쉽게 진단이 되기도 하나 폐렴 이외의 다른 호흡기 질환과의 감별이 필요할 때는 흉부 전산화 단층촬영(CT)등의 검사를 실시하기도 한다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/292e8f77-0b9b-4c4a-8200-d8bf6f5af9e0)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/b95c560e-9bf6-4f10-b10c-5ec8150cfe27)

<hr>

- **Pneumothorax(기흉)** : 기흉은 공기주머니에 해당하는 폐에 구멍이 생겨 공기가 새고 이로 인해 늑막강 내에 공기나 가스가 고이게 되는 질환이다.
허파와 흉부벽 사이의 흉강에 공기가 비정상적으로 모이는 현상.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/d8415b63-65c3-447a-9db9-cb346db8a22f)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/2aa42f04-3f02-4c03-b59a-ef8fe28b792c)

<hr>

- **Consolidation(폐 경화)** : 액체나 세포등이 폐포의 공기를 대체하여 폐가 단단하게 된 상태.
X선사진이나 CT에서 폐음영이 비교적 균일하게 증가하며,	폐용적의 변화가 거의 없다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/af925f86-2d8d-489a-a6ee-082671574fbd)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/1a65e7e5-8285-406e-a545-602672ea15c8)

<hr>

- **Edema(폐 부종)** : 혈관 밖의 폐조직인 폐간질 및 폐포에 비정상적으로 액체가 고이는 것. 즉, 말 그대로 폐에 물이 차는 것이다.
  
  	![image](https://github.com/not-null-i-want/medit/assets/145624456/3c8aff1f-7b57-4de7-8590-ea84a9b75efc)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/c462975c-d84f-4e60-b717-d5a53ebcf492)

<hr>

- **Emphysema(폐 기종)** : 기관지나 폐에 염증이 생기고, 이로 인하여 숨을 쉴 때 폐조직이(폐포) 늘어나는 것을 조절하는 섬유가 파괴된 상태로, 공기 흐름이 막힌것을 말한다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/6c4c3ad1-00b8-4fa9-a75b-f0a2c352ea4f)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/8bb61bb4-46d0-4829-b947-b467ff3170d8)

<hr>

- **Fibrosis(폐 섬유화)** : 폐 조직이 굳어서 심각한 호흡 장애를 불러일으키는 호흡기 질환이다. 섬유화가 진행된 폐조직을 복구할 수 있는 방법은 없다.

  	![image](https://github.com/not-null-i-want/medit/assets/145624456/c4fe15f2-0ffd-4b13-992e-0a6e6c63a399)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/be682383-7343-41a1-bc98-3da67e96716c)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/d0299fcd-65fc-4255-a56d-2c79bc783ebd)

<hr>

- **Pleural Thickening(흉막비후)** : 흉막이 딱딱하게 굳어 두꺼워지는 증상.

 	![image](https://github.com/not-null-i-want/medit/assets/145624456/ee1f3048-d107-4f47-b9e5-fa0ce8c58255)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/4df32e50-4f69-4063-873f-ae850ba8fd2e)

<hr>

- **Hernia(폐 탈장)** : 폐가 흉벽 밖으로 돌출되는 질환.
천식과 같은 폐 질환에서 잦은 기침은 흉강 내압을 증가시키고 폐를 탈장시킬 수 있다.

	![image](https://github.com/not-null-i-want/medit/assets/145624456/0483e34b-8f28-410d-b6bd-385f5f23059c)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/b5cfdb8d-48de-4378-874b-fae63bf03415)
	![image](https://github.com/not-null-i-want/medit/assets/145624456/ae13bca6-0c5e-479a-8d3c-93506aab549e)

</div>
</details>

<br>

## 🎥 시연 영상

https://github.com/not-null-i-want/medit/assets/145624456/85dda331-7db1-4419-9d7e-109bfcefe1dc

<br>


## 🧩 트러블 슈팅

### [김병훈]

<details>
<summary><b>ERR_INCOMPLETE_CHUNKED_ENCODING 200</b></summary>
<div markdown="1">

---

　🧨 오류 내용
- 양방향으로 연결된 Entity를 그대로 조회하는 경우 서로의 정보를 순환하면서 조회하다가 Stackoverflow가 발생하게 되었음.
- 이를 순환참조라고 하며, 참조하는 대상이 서로 물려있어 참조할 수 없게 되는 현상을 일컫는다.

　💡 해결 방법
- **@JsonIgnore** : JSON 데이터에 해당 프로퍼티는 null로 들어가게 된다. 해당하는 프로퍼티도 넘겨줘야 했기 때문에 이 방법은 사용하지 않았음.
- **@JsonManagedReference & @JsonBackReference** : 부모 클래스의 필드에 @JsonManagedReference를, 자식 클래스의 필드에 @JsonBackReference를 추가하여 순환참조를 막는다. **이 방법으로 해결하였음.**
- **DTO 사용** : 오류가 발생하게 된 주원인은 '양방향 매핑'이기도 하지만, 더 정확하게는 Entity 자체를 Response로 리턴한데에 있다. Entity 자체를 Return 하지 않고, DTO 객체를 만들어 필요한 데이터만 옮겨담아 Client로 리턴하면 순환 참조 관련 문제를 방지 할 수 있다.
- **매핑 재설정** : 만약 양방향 매핑이 필요가 없다면 단방향 매핑을 해줘서 자연스레 순환 참조 문제를 해결할 수 있다.

![image](https://github.com/not-null-i-want/medit/assets/145624456/58898a99-00c3-421f-a716-47e4ee71319d)

</div>
</details>

### [윤수민]

<details>
<summary><b>Failed to connect to service endpoint</b></summary>
<div markdown="1">

---

　🧨 오류 내용

	com.amazonaws.SdkClientException: Failed to connect to service endpoint:
	Caused by: java.net.SocketTimeoutException: connect timed out

　💡 해결 방법
- spring-cloud-starter-aws 의존성 주입시 로컬환경은 AWS환경이 아니기때문에 발생한다.
- 아래 구문을 SpringBootApplication에 적용하였음.

```java
@SpringBootApplication(
      exclude = {
              org.springframework.cloud.aws.autoconfigure.context.ContextInstanceDataAutoConfiguration.class,
              org.springframework.cloud.aws.autoconfigure.context.ContextStackAutoConfiguration.class,
              org.springframework.cloud.aws.autoconfigure.context.ContextRegionProviderAutoConfiguration.class
      }
 )
```

</div>
</details>

<details>
<summary><b>AmazonS3Exception: The specified bucket does not exist</b></summary>
<div markdown="1">

---

　🧨 오류 내용
 
![image](https://github.com/not-null-i-want/medit/assets/145624456/26c3db5b-d2c0-49b4-b8f2-56bc52e3de25)

　💡 해결 방법
- 버킷명은 유일해야 한다.
- yml이나 properties 파일에서 버킷명이 알맞게 입력됐나 점검, 수정하였음.

</div>
</details>

<details>
<summary><b>java.io.UncheckedIOException: Cannot delete</b></summary>
<div markdown="1">

---

　🧨 오류 내용
 
```
java.io.UncheckedIOException: Cannot delete C:\Users\smhrd\AppData\Local\Temp\tomcat.8089.1070292282324288404\work\Tomcat\localhost\medit\upload_09e1bcb3_1796_4afb_b0a8_86783c1dc4d2_00000001.tmp
...
Caused by: java.io.IOException: Cannot delete C:\Users\smhrd\AppData\Local\Temp\tomcat.8089.1070292282324288404\work\Tomcat\localhost\medit\upload_09e1bcb3_1796_4afb_b0a8_86783c1dc4d2_00000001.tmp
...
java.io.UncheckedIOException: Cannot delete C:\Users\smhrd\AppData\Local\Temp\tomcat.8089.1070292282324288404\work\Tomcat\localhost\medit\upload_09e1bcb3_1796_4afb_b0a8_86783c1dc4d2_00000001.tmp
...
2024-02-13 18:46:15.802 ERROR 4908 --- [nio-8089-exec-1] org.apache.tomcat.util.net.NioEndpoint   : Error running socket processor
```

　💡 해결 방법
- 스프링부트 버전 문제로 발생.
- 버전을 2.7.6으로 변경하였음.

```xml
<parent>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-parent</artifactId>
      <version>2.7.6</version>
      <relativePath/>
</parent>
```

</div>
</details>

<details>
<summary><b>com.fasterxml.jackson.databind.exc.InvalidDefinitionException</b></summary>
<div markdown="1">

---

　🧨 오류 내용
- **Jackson 라이브러리가 자바 객체를 JSON으로 변환하려고 할 때, 클래스 정의에 문제가 있어서 발생하는 예외다.**
- JPA 엔티티가 지연 로딩(Lazy Loading) 전략을 사용하여 연관된 객체를 로드하는 경우에 특히 그럴 수 있는데 이 때문에 Jackson이 해당 프록시 객체를 올바르게 직렬화하지 못한다.
  <br>
  
	- **직렬화**: 객체의 상태를 바이트 스트림으로 변환하는 과정이다. 이는 네트워크로 전송하거나 파일에 저장하기 위해 사용된다.
	- **즉시 로딩(Eager)**: 엔티티를 조회하면 연관 관계에 있는 엔티티까지 조회.
   	- **지연 로딩(Lazy)**: 해당 엔티티만 조회하고 연관되어 있는 나머지 데이터는 나중으로 미룸.
   	- 실무에서는 **즉시 로딩은 지양**함 = 아무리 단순한 구조의 설계라도, 시간이 지나면 변화되고 추가되기 마련이므로 개발 과정에서 임시로 사용하는 게 아니라면, 항상 지연 로딩을 사용함으로써 성능 이슈가 발생할 가능성을 줄여주는 것이 좋다!
	- @ManyToOne 매핑의 **기본 fetch가 EAGER**라서 생략해도 EAGER로 동작한다.

　💡 해결 방법
- DTO를 만든다거나 여러 방법이 있지만 **Jackson Custom Serializer**를 만들었음.
 
	１. JsonSerializer를 상속받아 커스텀할 Serializer를 만든다.

	２. JsonGenerator.writeStartObject()으로 시작을 열어준다.

 	３. JsonGenerator.write`자료형`Field("필드 이름", 값)으로 지정한다.
  
  	４. JsonGenerator.writeEndObject()로 닫아줌으로써 로직을 구성한다.
  	<br>
   
  	![image](https://github.com/not-null-i-want/medit/assets/145624456/6cb0c7ea-cfa7-4bd1-a7d4-b8145397943e)

  	５. 만든 Custom Serializer를 사용하려는 필드에 @JsonSerialize(using = CustomSerializer.class)를 추가한다.
  	<br>
   
  	![image](https://github.com/not-null-i-want/medit/assets/145624456/babc1a12-60f8-42d3-ba1c-6280eb466ead)



</div>
</details>

### [이동훈]

<details>
<summary><b>OMP: Error #15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.</b></summary>
<div markdown="1">

---

　🧨 오류 내용

 - 각종 커널(라이브러리)들의 충돌이 발생

　💡 해결 방법
- openmp 커널 충돌 방지를 위해 코드를 입력하였음

```py
import os
os.environ['KMP_DUPLICATE_LIB_OK'] = 'True'
```

</div>
</details>

<br>

## 👨‍👦‍👦 팀원 소개
<table>
    <tr>
        <td align="center" width="250px"><b>정연희</b></td>
        <td align="center" width="250px"><b>김병훈</b></td>
        <td align="center" width="250px"><b>윤수민</b></td>
        <td align="center" width="250px"><b>임지후</b></td>
        <td align="center" width="250px"><b>이동훈</b></td>
    </tr>
    <tr>
        <td align="center" colspan="5">Main</td>
    </tr>
    <tr>
        <td align="center">PM, Back-end</td>
        <td align="center">Back-end</td>
        <td align="center">Back-end, Front-end</td>
        <td align="center">Back-end</td>
        <td align="center">Deep Learning</td>
    </tr>
    <tr>
        <td align="center" colspan="5">Sub</td>
    </tr>
    <tr>
        <td align="center">Deep Learning</td>
        <td align="center">Front-end</td>
        <td align="center"></td>
        <td align="center">Front-end</td>
        <td align="center"></td>
    </tr>
    <tr>
        <td align="center" colspan="5">업무 분장</td>
    </tr>
    	<tr>
			<td><h5>
				- 웹소켓을 활용한 일대일 채팅 기능 구현<br><br>
                       		- 모달창 기능 구현<br><br>
				- AWS S3 서버에서 flask로 이미지 주소값 불러오기<br><br>
				- 처리된 이미지 AWS S3로 파일 업로드<br><br>
				- flask에서 넘어온 이미지 주소값, 딥러닝 예측 결과값 처리<br><br>
			</h5></td>
			<td><h5>
				- 환자 등록 기능 구현<br><br>
				- 주소 카카오 api연동<br><br>
				- 환자별 진단 날짜 출력<br><br>
				- 진단 날짜별 의사 소견 출력<br><br>
				- 의사 소견 등록, 삭제, 수정 기능 구현<br><br>
				- 진단 날짜 페이징 처리, 관련 생성자&entity 구현<br><br>
				- 채팅, 진단 날짜, 의사소견, 채팅창 CSS<br><br>
			</h5></td>
			<td><h5>
				- DB 설계 및 구현<br><br>
				- UI/UX 설계<br><br>
				- Pageable을 이용한 환자 검색 및 목록 페이징 처리<br><br>
    			- 환자 상세정보 출력<br><br>
				- 진단 작성 기능 구현<br><br>
				- AWS S3 Bucket으로 이미지 업로드 기능 구현<br><br>
    			- CXR 원본 이미지 출력<br><br>
				- 모델로부터 추론된 진단 결과 출력<br><br>
    			- HTML5 Canvas를 이용한 CXR 이미지 편집 기능 구현(펜 굵기, 색상, 클리어, On/Off)<br><br>
				- Chart.js로 각 확률값들 그래프화<br><br>
				- AWS EC2, AWS S3 환경 구축<br><br>
    			- EC2 인스턴스에 SpringBoot 서버 배포<br><br>
				- 전체적인 페이지 UI/UX 구현(로고, 레이아웃, 메인페이지, 환자검색, 환자목록, 상세정보, 진단, 환자 등록, 진단 결과, 각종 애니메이션)<br>
			</h5></td>
			<td><h5>
				- 환자목록 페이지 기능 구현<br><br>
				- 환자 상세정보 기능 구현<br><br>
				- 환자등록 페이지 비동기 기능 구현<br><br>
				- 비교군 CXR 출력 비동기 기능 구현<br><br>
				- 비교군 CXR 페이징 및 비교군  CXR CSS 구현<br><br>
				- CXR Visualize on/off 비동기 구현<br><br>
			</h5></td>
			<td><h5>
				- 환자 검색 및 로그인 기능 구현<br><br>
				- aws s3서버 -> flask로 이미지 주소값 받아오기<br><br>
				- flask서버 -> aws s3서버로 처리된이미지 파일 업로드 및 업로드된 주소값 받아오기<br><br>
				- 이미지 전처리 및 TTA 방식을 통한 테스트 로직 구현<br><br>
				- 처리후 결과값, 결과이미지 주소 스프링부트로 넘겨주기<br><br>
			</h5></td>
    	</tr>
	<tr>
		<td colspan="5" align="center">Github</td>
	</tr>
    	<tr>
		<td align="center"><a href="https://github.com/youneeee/YounheeJung">@youneeee</a></td>
		<td align="center"><a href="https://github.com/hoon801">@hoon801</a></td>
		<td align="center"><a href="https://github.com/explorersm11">@explorersm11</a></td>
		<td align="center"><a href="https://github.com/yim7595/yim7595">@yim7595</a></td>
		<td align="center"><a href="https://github.com/opencv256/opencv256">@opencv256</a></td>
	</tr>
</table>

<div align="center">
	
### 🙏 마지막으로 저희에게 최고의 길잡이가 되어주신 👏
### 🧠<a href="https://github.com/dongseop-kim">김동섭 멘토님</a>에게 진심으로 감사드립니다! 
</div>
